{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">‚ö° Find Shortest Path Between Airports</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="{{ form.from_airport.id_for_label }}" class="form-label">From Airport</label>
                            {{ form.from_airport }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.to_airport.id_for_label }}" class="form-label">To Airport</label>
                            {{ form.to_airport }}
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg">
                            üöÄ Find Shortest Path
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results -->
        {% if result %}
        <div class="card mt-4 border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üìç Shortest Path Found</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <div class="row mb-3">
                        <div class="col-md-6 text-center">
                            <h6>Start</h6>
                            <div class="p-3 bg-light rounded">
                                <strong>{{ form.from_airport.value.code }}</strong><br>
                                <small>{{ form.from_airport.value.name }}</small>
                            </div>
                        </div>
                        <div class="col-md-6 text-center">
                            <h6>Destination</h6>
                            <div class="p-3 bg-light rounded">
                                <strong>{{ form.to_airport.value.code }}</strong><br>
                                <small>{{ form.to_airport.value.name }}</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="text-center mb-3">
                        <h5>Total Duration: <span class="badge bg-warning text-dark fs-6">{{ result.total_duration }} minutes</span></h5>
                    </div>

                    <h6>Route Path:</h6>
                    <div class="p-3 bg-white rounded border">
                        <div class="route-path text-center">
                            {% for airport in result.path %}
                                <span class="airport-stop">
                                    <strong>{{ airport.code }}</strong>
                                    {% if not forloop.last %}
                                        <span class="arrow mx-3">‚û°Ô∏è</span>
                                    {% endif %}
                                </span>
                            {% endfor %}
                        </div>
                        <div class="text-center mt-2 text-muted">
                            <small>{{ result.path|length }} airports in path</small>
                        </div>
                    </div>

                    <!-- Detailed Steps -->
                    <div class="mt-4">
                        <h6>Detailed Journey:</h6>
                        <div class="timeline">
                            {% for airport in result.path %}
                                <div class="d-flex align-items-center mb-2">
                                    <div class="timeline-badge">
                                        <span class="badge bg-primary">{{ forloop.counter }}</span>
                                    </div>
                                    <div class="timeline-content ms-3 p-2 bg-light rounded flex-grow-1">
                                        <strong>{{ airport.code }}</strong> - {{ airport.name }}
                                    </div>
                                </div>
                                {% if not forloop.last %}
                                    <div class="text-center text-muted">
                                        <small>‚Üì</small>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% elif result == None and request.method == 'POST' %}
        <div class="card mt-4 border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">‚ùå No Path Found</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <h6>No connecting path found between selected airports.</h6>
                    <p class="mb-0">
                        There is no route from <strong>{{ form.from_airport.value.code }}</strong> 
                        to <strong>{{ form.to_airport.value.code }}</strong> in the current route network.
                    </p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Quick Path Examples -->
        <div class="card mt-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">üí° How It Works</h5>
            </div>
            <div class="card-body">
                <p>The system uses pathfinding algorithms to discover the shortest route between any two airports, considering:</p>
                <ul>
                    <li>Direct connections</li>
                    <li>Multi-hop routes through intermediate airports</li>
                    <li>Both left and right direction routes</li>
                    <li>Total cumulative duration</li>
                </ul>
                <div class="alert alert-info">
                    <strong>Example:</strong> A ‚Üí B ‚Üí C might be faster than A ‚Üí C directly if the direct route has a longer duration.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}